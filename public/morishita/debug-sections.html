<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-info { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .section-item { margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 3px; }
        .test-section { padding: 20px; margin: 10px 0; border: 2px solid #ccc; }
        button { padding: 10px 15px; margin: 5px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1976D2; }
        .log { background: #000; color: #0f0; padding: 10px; font-family: monospace; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="debug-info">
        <h2>ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³</h2>
        <div class="test-section" id="header-component">
            <h3>ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (ID: header-component)</h3>
            <p>ã“ã‚Œã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã™</p>
            <span>ç·¨é›†å¯èƒ½ãªãƒ†ã‚­ã‚¹ãƒˆ</span>
        </div>
        
        <div class="test-section" id="hero-component">
            <h3>ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (ID: hero-component)</h3>
            <p>ã“ã‚Œã¯ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã™</p>
            <span>åˆ¥ã®ç·¨é›†å¯èƒ½ãªãƒ†ã‚­ã‚¹ãƒˆ</span>
        </div>
        
        <section class="about test-section">
            <h3>Aboutã‚»ã‚¯ã‚·ãƒ§ãƒ³ (section tag + class)</h3>
            <p>ã“ã‚Œã¯Aboutã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã™</p>
            <div>ãƒã‚¹ãƒˆã—ãŸè¦ç´ </div>
        </section>
        
        <div class="programs test-section">
            <h3>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (class only)</h3>
            <p>ã“ã‚Œã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã™</p>
            <button>ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³</button>
        </div>
    </div>
    
    <div class="debug-info">
        <h2>åˆ¶å¾¡ãƒ‘ãƒãƒ«</h2>
        <button onclick="testSectionDetection()">ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testHeaderSection()">ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testHeroSection()">ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testAboutSection()">Aboutã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testProgramsSection()">ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>
    
    <div class="debug-info">
        <h2>æ¤œå‡ºçµæœ</h2>
        <div id="detection-results"></div>
    </div>
    
    <div class="debug-info">
        <h2>ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h2>
        <div id="debug-log" class="log"></div>
    </div>

    <script>
        // ãƒ­ã‚°æ©Ÿèƒ½
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44' : type === 'success' ? '#4f4' : type === 'warning' ? '#fa4' : '#0f0';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('debug-log').innerHTML = '';
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºé–¢æ•°ï¼ˆFloatingControlsã‹ã‚‰ç§»æ¤ï¼‰
        function detectSections() {
            const sections = [];
            
            log('ğŸ” ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºé–‹å§‹', 'info');
            
            // è¤‡æ•°ã®æ–¹æ³•ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¤œå‡º
            const componentElements = document.querySelectorAll('[id$="-component"]');
            log(`ğŸ“‹ -componentè¦ç´ : ${componentElements.length}å€‹`, 'info');
            
            const sectionElements = document.querySelectorAll('section');
            log(`ğŸ“‹ sectionè¦ç´ : ${sectionElements.length}å€‹`, 'info');
            
            const classBasedElements = document.querySelectorAll('.hero, .about, .programs, .pricing, .schedule, .access, .footer, .site-header');
            log(`ğŸ“‹ ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹è¦ç´ : ${classBasedElements.length}å€‹`, 'info');
            
            const sectionNames = {
                'header': 'ãƒ˜ãƒƒãƒ€ãƒ¼',
                'hero': 'ãƒ’ãƒ¼ãƒ­ãƒ¼', 
                'about': 'ã‚¹ã‚¿ã‚¸ã‚ªç´¹ä»‹',
                'programs': 'ãƒ—ãƒ­ã‚°ãƒ©ãƒ ',
                'pricing': 'æ–™é‡‘ãƒ—ãƒ©ãƒ³',
                'schedule': 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«',
                'access': 'ã‚¢ã‚¯ã‚»ã‚¹',
                'footer': 'ãƒ•ãƒƒã‚¿ãƒ¼'
            };

            // ã™ã¹ã¦ã®å€™è£œè¦ç´ ã‚’çµ±åˆ
            const allCandidates = new Set();
            
            componentElements.forEach(element => allCandidates.add(element));
            sectionElements.forEach(element => allCandidates.add(element));
            classBasedElements.forEach(element => allCandidates.add(element));
            
            log(`ğŸ¯ çµ±åˆå€™è£œè¦ç´ : ${allCandidates.size}å€‹`, 'info');
            
            allCandidates.forEach(element => {
                let sectionId = '';
                let displayName = '';
                
                // IDã‹ã‚‰åˆ¤å®š
                if (element.id) {
                    if (element.id.includes('-component')) {
                        sectionId = element.id.replace('-component', '');
                    } else if (element.id.includes('header')) {
                        sectionId = 'header';
                    } else if (element.id.includes('hero')) {
                        sectionId = 'hero';
                    } else {
                        sectionId = element.id;
                    }
                }
                
                // ã‚¯ãƒ©ã‚¹åã‹ã‚‰åˆ¤å®š
                if (!sectionId && element.className) {
                    const classList = element.className.toLowerCase();
                    if (classList.includes('header')) sectionId = 'header';
                    else if (classList.includes('hero')) sectionId = 'hero';
                    else if (classList.includes('about')) sectionId = 'about';
                    else if (classList.includes('program')) sectionId = 'programs';
                    else if (classList.includes('pricing')) sectionId = 'pricing';
                    else if (classList.includes('schedule')) sectionId = 'schedule';
                    else if (classList.includes('access')) sectionId = 'access';
                    else if (classList.includes('footer')) sectionId = 'footer';
                }
                
                // ã‚¿ã‚°åã‹ã‚‰åˆ¤å®š
                if (!sectionId && element.tagName.toLowerCase() === 'header') {
                    sectionId = 'header';
                } else if (!sectionId && element.tagName.toLowerCase() === 'footer') {
                    sectionId = 'footer';
                }
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                if (!sectionId) {
                    sectionId = element.id || element.className || 'unknown';
                }
                
                displayName = sectionNames[sectionId] || sectionId;
                
                sections.push({
                    id: sectionId,
                    displayName: displayName,
                    element: element
                });
                
                log(`â• ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ : ${sectionId} (${displayName}) - ${element.tagName}#${element.id}.${element.className}`, 'success');
            });

            log(`âœ… æ¤œå‡ºå®Œäº†: ${sections.length}å€‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³`, 'success');
            return sections;
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠãƒ†ã‚¹ãƒˆé–¢æ•°
        function simulateSectionSelection(sectionData) {
            log(`ğŸ¯ ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ${sectionData.displayName}`, 'warning');
            log(`è¦ç´ : ${sectionData.element.tagName}#${sectionData.element.id}.${sectionData.element.className}`, 'info');
            
            // sectionSelectedã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
            const event = new CustomEvent('sectionSelected', {
                detail: { section: sectionData.element }
            });
            document.dispatchEvent(event);
            log('sectionSelectedã‚¤ãƒ™ãƒ³ãƒˆç™ºç«å®Œäº†', 'success');
            
            // SectionClickEditorãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (window.sectionClickEditor) {
                log('SectionClickEditorãŒå­˜åœ¨ã—ã¾ã™', 'success');
                log(`SectionClickEditor.isActive: ${window.sectionClickEditor.isActive}`, 'info');
                log(`SectionClickEditor.currentSection: ${window.sectionClickEditor.currentSection ? window.sectionClickEditor.currentSection.tagName : 'null'}`, 'info');
                log(`ç·¨é›†å¯èƒ½è¦ç´ æ•°: ${window.sectionClickEditor.editableElements.size}`, 'info');
            } else {
                log('SectionClickEditorãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }

        // ãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤
        function testSectionDetection() {
            log('=== ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'warning');
            const sections = detectSections();
            
            const resultsDiv = document.getElementById('detection-results');
            resultsDiv.innerHTML = '<h3>æ¤œå‡ºã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³:</h3>';
            
            sections.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section-item';
                sectionDiv.innerHTML = `
                    <strong>${section.displayName}</strong> (ID: ${section.id})<br>
                    è¦ç´ : ${section.element.tagName}<br>
                    ID: ${section.element.id}<br>
                    Class: ${section.element.className}<br>
                    <button onclick="simulateSectionSelection(${JSON.stringify({
                        id: section.id,
                        displayName: section.displayName,
                        element: 'ELEMENT_REF'
                    }).replace('"ELEMENT_REF"', `document.querySelector('#${section.element.id}') || document.querySelector('.${section.element.className.split(' ')[0]}')`)})" style="background: #4CAF50; margin-top: 5px;">ã“ã®è¦ç´ ã‚’é¸æŠãƒ†ã‚¹ãƒˆ</button>
                `;
                resultsDiv.appendChild(sectionDiv);
            });
        }

        function testHeaderSection() {
            const element = document.getElementById('header-component');
            if (element) {
                simulateSectionSelection({
                    id: 'header',
                    displayName: 'ãƒ˜ãƒƒãƒ€ãƒ¼',
                    element: element
                });
            } else {
                log('ãƒ˜ãƒƒãƒ€ãƒ¼è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }

        function testHeroSection() {
            const element = document.getElementById('hero-component');
            if (element) {
                simulateSectionSelection({
                    id: 'hero',
                    displayName: 'ãƒ’ãƒ¼ãƒ­ãƒ¼',
                    element: element
                });
            } else {
                log('ãƒ’ãƒ¼ãƒ­ãƒ¼è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }

        function testAboutSection() {
            const element = document.querySelector('.about');
            if (element) {
                simulateSectionSelection({
                    id: 'about',
                    displayName: 'ã‚¹ã‚¿ã‚¸ã‚ªç´¹ä»‹',
                    element: element
                });
            } else {
                log('Aboutè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }

        function testProgramsSection() {
            const element = document.querySelector('.programs');
            if (element) {
                simulateSectionSelection({
                    id: 'programs',
                    displayName: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒ ',
                    element: element
                });
            } else {
                log('ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }

        // SectionClickEditorã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ¢ãƒ‹ã‚¿ãƒ¼
        document.addEventListener('sectionSelected', (event) => {
            log('ğŸ‰ sectionSelectedã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã—ã¾ã—ãŸ!', 'success');
            log(`ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦ç´ : ${event.detail.section.tagName}#${event.detail.section.id}`, 'info');
        });

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸åˆæœŸåŒ–å®Œäº†', 'success');
            log('SectionClickEditorã®çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...', 'info');
            
            // SectionClickEditorã®å­˜åœ¨ç¢ºèª
            setTimeout(() => {
                if (window.sectionClickEditor) {
                    log('SectionClickEditorãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ', 'success');
                } else {
                    log('SectionClickEditorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                }
            }, 1000);
        });
    </script>
</body>
</html>